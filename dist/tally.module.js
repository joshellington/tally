var t,n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},e=(function(t){!function(n){function e(t,n){var e=(65535&t)+(65535&n);return(t>>16)+(n>>16)+(e>>16)<<16|65535&e}function r(t,n,r,o,i,u){return e((c=e(e(n,t),e(o,u)))<<(s=i)|c>>>32-s,r);var c,s}function o(t,n,e,o,i,u,c){return r(n&e|~n&o,t,n,i,u,c)}function i(t,n,e,o,i,u,c){return r(n&o|e&~o,t,n,i,u,c)}function u(t,n,e,o,i,u,c){return r(n^e^o,t,n,i,u,c)}function c(t,n,e,o,i,u,c){return r(e^(n|~o),t,n,i,u,c)}function s(t,n){var r,s,a,h,d;t[n>>5]|=128<<n%32,t[14+(n+64>>>9<<4)]=n;var l=1732584193,f=-271733879,v=-1732584194,g=271733878;for(r=0;r<t.length;r+=16)s=l,a=f,h=v,d=g,l=o(l,f,v,g,t[r],7,-680876936),g=o(g,l,f,v,t[r+1],12,-389564586),v=o(v,g,l,f,t[r+2],17,606105819),f=o(f,v,g,l,t[r+3],22,-1044525330),l=o(l,f,v,g,t[r+4],7,-176418897),g=o(g,l,f,v,t[r+5],12,1200080426),v=o(v,g,l,f,t[r+6],17,-1473231341),f=o(f,v,g,l,t[r+7],22,-45705983),l=o(l,f,v,g,t[r+8],7,1770035416),g=o(g,l,f,v,t[r+9],12,-1958414417),v=o(v,g,l,f,t[r+10],17,-42063),f=o(f,v,g,l,t[r+11],22,-1990404162),l=o(l,f,v,g,t[r+12],7,1804603682),g=o(g,l,f,v,t[r+13],12,-40341101),v=o(v,g,l,f,t[r+14],17,-1502002290),l=i(l,f=o(f,v,g,l,t[r+15],22,1236535329),v,g,t[r+1],5,-165796510),g=i(g,l,f,v,t[r+6],9,-1069501632),v=i(v,g,l,f,t[r+11],14,643717713),f=i(f,v,g,l,t[r],20,-373897302),l=i(l,f,v,g,t[r+5],5,-701558691),g=i(g,l,f,v,t[r+10],9,38016083),v=i(v,g,l,f,t[r+15],14,-660478335),f=i(f,v,g,l,t[r+4],20,-405537848),l=i(l,f,v,g,t[r+9],5,568446438),g=i(g,l,f,v,t[r+14],9,-1019803690),v=i(v,g,l,f,t[r+3],14,-187363961),f=i(f,v,g,l,t[r+8],20,1163531501),l=i(l,f,v,g,t[r+13],5,-1444681467),g=i(g,l,f,v,t[r+2],9,-51403784),v=i(v,g,l,f,t[r+7],14,1735328473),l=u(l,f=i(f,v,g,l,t[r+12],20,-1926607734),v,g,t[r+5],4,-378558),g=u(g,l,f,v,t[r+8],11,-2022574463),v=u(v,g,l,f,t[r+11],16,1839030562),f=u(f,v,g,l,t[r+14],23,-35309556),l=u(l,f,v,g,t[r+1],4,-1530992060),g=u(g,l,f,v,t[r+4],11,1272893353),v=u(v,g,l,f,t[r+7],16,-155497632),f=u(f,v,g,l,t[r+10],23,-1094730640),l=u(l,f,v,g,t[r+13],4,681279174),g=u(g,l,f,v,t[r],11,-358537222),v=u(v,g,l,f,t[r+3],16,-722521979),f=u(f,v,g,l,t[r+6],23,76029189),l=u(l,f,v,g,t[r+9],4,-640364487),g=u(g,l,f,v,t[r+12],11,-421815835),v=u(v,g,l,f,t[r+15],16,530742520),l=c(l,f=u(f,v,g,l,t[r+2],23,-995338651),v,g,t[r],6,-198630844),g=c(g,l,f,v,t[r+7],10,1126891415),v=c(v,g,l,f,t[r+14],15,-1416354905),f=c(f,v,g,l,t[r+5],21,-57434055),l=c(l,f,v,g,t[r+12],6,1700485571),g=c(g,l,f,v,t[r+3],10,-1894986606),v=c(v,g,l,f,t[r+10],15,-1051523),f=c(f,v,g,l,t[r+1],21,-2054922799),l=c(l,f,v,g,t[r+8],6,1873313359),g=c(g,l,f,v,t[r+15],10,-30611744),v=c(v,g,l,f,t[r+6],15,-1560198380),f=c(f,v,g,l,t[r+13],21,1309151649),l=c(l,f,v,g,t[r+4],6,-145523070),g=c(g,l,f,v,t[r+11],10,-1120210379),v=c(v,g,l,f,t[r+2],15,718787259),f=c(f,v,g,l,t[r+9],21,-343485551),l=e(l,s),f=e(f,a),v=e(v,h),g=e(g,d);return[l,f,v,g]}function a(t){var n,e="",r=32*t.length;for(n=0;n<r;n+=8)e+=String.fromCharCode(t[n>>5]>>>n%32&255);return e}function h(t){var n,e=[];for(e[(t.length>>2)-1]=void 0,n=0;n<e.length;n+=1)e[n]=0;var r=8*t.length;for(n=0;n<r;n+=8)e[n>>5]|=(255&t.charCodeAt(n/8))<<n%32;return e}function d(t){var n,e,r="0123456789abcdef",o="";for(e=0;e<t.length;e+=1)n=t.charCodeAt(e),o+=r.charAt(n>>>4&15)+r.charAt(15&n);return o}function l(t){return unescape(encodeURIComponent(t))}function f(t){return function(t){return a(s(h(t),8*t.length))}(l(t))}function v(t,n){return function(t,n){var e,r,o=h(t),i=[],u=[];for(i[15]=u[15]=void 0,o.length>16&&(o=s(o,8*t.length)),e=0;e<16;e+=1)i[e]=909522486^o[e],u[e]=1549556828^o[e];return r=s(i.concat(h(n)),512+8*n.length),a(s(u.concat(r),640))}(l(t),l(n))}function g(t,n,e){return n?e?v(n,t):d(v(n,t)):e?f(t):d(f(t))}t.exports?t.exports=g:n.md5=g}(n)}(t={exports:{}}),t.exports),r=function(){function t(t){var n=this,r=this,o=this;this.options=t,this.baseUrl=t.apiUrl?t.apiUrl:"https://tally-data-dev.s3.amazonaws.com",this.id=t.id?e(window.location.href+t.id.toString()).toString():e(window.location.href).toString(),this.interval=t.interval?t.interval:1e3,this.running=!1,this.count=0,this.loop=null,this.stop=this.stop,window.addEventListener("beforeunload",function(t){try{return r.unload(),Promise.resolve()}catch(t){return Promise.reject(t)}}),window.addEventListener("unload",function(t){try{return o.unload(),Promise.resolve()}catch(t){return Promise.reject(t)}}),document.addEventListener("visibilitychange",function(t){"hidden"===document.visibilityState||"unloaded"===document.visibilityState?n.unload():"visible"===document.visibilityState&&n.add()}),(["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document)&&(window.addEventListener("pagehide",function(t){n.unload()}),window.addEventListener("pageshow",function(t){n.add()})),this.start()}var n=t.prototype;return n.start=function(){try{var t=this,n=function(){if(!t.running)return Promise.resolve(t.add()).then(function(){t.loop=setInterval(function(){try{return Promise.resolve(t.get()).then(function(){})}catch(t){return Promise.reject(t)}},t.interval),t.running=!0})}();return Promise.resolve(n&&n.then?n.then(function(){}):void 0)}catch(t){return Promise.reject(t)}},n.dispatch=function(){var t=new CustomEvent("tally.change",{detail:{count:this.count,running:this.running}});window.dispatchEvent(t),this.options.change&&this.options.change({count:this.count,running:this.running})},n.add=function(){try{var t=this;return Promise.resolve(t.get()).then(function(){return Promise.resolve(fetch(t.baseUrl+"/"+t.id+".txt",{method:"put",body:t.count+1})).then(function(){t.dispatch()})})}catch(t){return Promise.reject(t)}},n.get=function(){try{var t=this;return Promise.resolve(function(n,e){try{var r=Promise.resolve(fetch(t.baseUrl+"/"+t.id+".txt")).then(function(n){if(!n.ok)throw new Error("NO FILE");return Promise.resolve(n.text()).then(function(n){t.count=parseInt(n),t.dispatch()})})}catch(t){return e(t)}return r&&r.then?r.then(void 0,e):r}(0,function(n){return console.log(n.message),Promise.resolve(t.create()).then(function(){return Promise.resolve(t.get()).then(function(){})})}))}catch(t){return Promise.reject(t)}},n.create=function(){try{return Promise.resolve(fetch(this.baseUrl+"/"+this.id+".txt",{method:"put",body:0})).then(function(){})}catch(t){return Promise.reject(t)}},n.unload=function(){fetch(this.baseUrl+"/"+this.id+".txt",{method:"put",body:this.count>0?this.count-1:0,keepalive:!0})},n.stop=function(){clearInterval(this.loop),this.unload(),this.running=!1},t}();export default r;
//# sourceMappingURL=tally.module.js.map
